<!DOCTYPE html>  
<html lang="en"> 
<head> 
    <title>My Page</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<script src="./jquery-1.8.2.min.js"></script>
	<link rel="stylesheet" href="./jquery.mobile-1.3.0-rc.1.min.css" />
	<link rel="stylesheet" href="./styles.css" />
	<script src="./jquery.mobile-1.3.0-rc.1.min.js"></script>
	<script src="./functions.js"></script>

	<script type="text/javascript">
	var loaded = 0;
	var count = 0;
	var jsontext = [];//= new Object();
	var page = 0;
	var host = location.hostname;
	var url_to_fetch = "http://"+host+"/msapp/sanitize.php";
	var category_page = "http://"+host+"/msapp/category.html";
	var post_page = "http://"+host+"/msapp/post.html";
	var url_to_fetch_for_cat = "http://"+host+"/msapp/sanitize_cat.php";
	var loading = 0;
	$.holdReady(true);
	$.ajax ({
			url: url_to_fetch_for_cat,
			type: "GET",
			dataType: "json",
			async: "false",
			success: function (clone) {
				jQuery.each(clone.mag_categories,function (index,cat){
					create_category(cat.MagCategory.id,cat.MagCategory.name);
				});
			},
			error: function(xhr,error,errorthrown) {
				alert("ERROR: "+error+" , "+errorthrown);
			}
	}).done(function(){
		$.holdReady(false);	
	});
	$(document).ready(function () {
	$.ajax({
            url: url_to_fetch,
            type: "GET",
            dataType: "json",
            data: { last_page_id: 0 },
			async: "false",
            success: function (clone) {
            	jsontext = clone;
				count = jsontext['mag_posts'].length;
				var height_container = $('.scrollbox').height();
				var initial_posts = Math.round(height_container/224); 
				for ( var index = 0;index <= initial_posts;index++ )
				{
					create_post(jsontext,index,0);
					loaded+=1;
				}
            },
            error: function (xhr,error,errorthrown) {
                alert("ERROR: "+error+" , "+errorthrown);
			}
	}); 
	$('.scrollbox').scroll(function() {
		if ( loading == 0 ) {	
			scrollalert();
		}
		else {
			return false;
		}
	});
	/*** When clicked on a category , set the local storage for the clicked category id ***/
	$(document).on("click",".category",function() {
		sessionStorage.clickCategory = $(this).attr('data-category');
		window.location.href = category_page;
		//$.mobile.changePage(category_page,{transition:"slide"});
	});
	/*** When clicked on a post , set the local storage for the clicked post id ***/
	$(document).on("click",".post-title",function() {
		sessionStorage.clickPost = $(this).attr('data-post');
		window.location.href = post_page;
	});
	});
 </script>
</head> 
<body data-scroll="true"> 
<div class="page" data-role="page" data-scroll="false">
	<div class="header" data-role="header">
		<a href="#leftpanel3" data-icon="bars" data-role="button" data-inline="true" data-display="reveal"  
						data-position="left" data-dismissible="true" data-iconpos="notext" data-theme="a"></a>
		<h1>Wedding Blog</h1>
	</div><!-- /header -->
	<div class="scrollbox" data-role="content" data-scroll="true">
	
	<div class="content">

		</div>
	</div><!-- /content -->
	<div data-role="footer">
		<h1>Footer</h1>
	</div><!-- /footer -->
	<div data-role="panel" id="leftpanel3" data-position="left" data-display="overlay" data-dismissible="true" class="ui-responsive" data-theme="a" >
				<!--<div class="panel-content">-->
					<ul data-role="listview" data-theme="a" data-divider-theme="b" style="margin-top:-1px;" data-iconpos="none">
					<li><img src="./me.png"><span>Ankit Sharma</span><p>Mobile Developer</p></li>
					<li data-role="list-divider" class="cat-divider">CATEGORIES</li>
					<li data-role="list-divider">MENU</li>
					<li>
						<a href="">Home</a>
					</li>
					<li>
						<a href="">Gallery</a>
					</li>
					<li>
						<a href="">Create Wedsite</a>
					</li>
					<li>
						<a href="">Help</a>
					</li>
				</ul>
			<!--</div>-->
	</div>
	<!-- /leftpanel3 -->

	</div><!-- /page -->

</body>
</html>
